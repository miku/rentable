{% extends "base.html" %}

{% block scripts %}
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
    <!--[if lte IE 8]>
         <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
    <script>
        $(document).ready(function() {
            var map = L.map('map').setView([51.34, 12.38], 12); // Leipzig
            var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
            var osmAttrib='Map data Â© OpenStreetMap contributors';
            var osm = new L.TileLayer(osmUrl, {minZoom: 1, maxZoom: 18, attribution: osmAttrib});       
            map.addLayer(osm);
            $.ajax({
                type: "GET",
                url: "{{ urlFor('geojson') }}",
                dataType: 'json',
                success: function (response) {
                    geojsonLayer = L.geoJson(response, {
                        onEachFeature: function (feature, layer) {
                            layer.bindPopup(feature.properties.styled, 
                                { className: 'rentable-marker' });
                        }
                    }).addTo(map);
                }
            });            
        });
    </script>
{% endblock %}

{% block main %}
    <div class="unit span-grid">
        <p>
            Rentable is your premium source for lending just about everyting. There are
            currently {{ random(1000) }} items to lend, from houses to helicopters.
        </p>
    </div>
    <div class="unit span-grid">
        <div id="map"></div>
    </div>
{% endblock %}